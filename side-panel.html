<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="side-panel.css" />
        <title>Local Browser AI - Side Panel</title>
    </head>
    <body class="v-flex">
        <header>
            <a href="https://alexewerlof.com" target="_blank"><img src="images/logo.png" class="alex-logo" /></a>
            <a href="https://blog.alexewerlof.com/p/local-browser-ai" target="_blank">Intro</a>
            <a href="https://github.com/alexewerlof/local-browser-ai/issues" target="_blank">Issues</a>
            <a href="https://github.com/alexewerlof/local-browser-ai/blob/main/privacy.txt" target="_blank">Privacy</a>
            <span id="version" title="Version" class="subtle-text grow-flex">version</span>
            <button id="new-session-button" hidden>New Chat</button>
            <button id="reset-button">Reset</button>
        </header>
        <main id="boot-ui">
            <div id="api-status">Checking availability...</div>
            <table id="system-requirements">
                <caption>
                    System Requirements
                </caption>
                <thead>
                    <tr>
                        <th></th>
                        <th>
                            <a href="https://developer.chrome.com/docs/ai/prompt-api" target="_blank">Chrome</a>
                        </th>
                        <th>
                            <a
                                href="https://learn.microsoft.com/en-us/microsoft-edge/web-platform/prompt-api"
                                target="_blank"
                                >Edge</a
                            >
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>OS</th>
                        <td>Linux, MacOS 13+, ChromeOS, Windows</td>
                        <td>Windows 11, MacOS 13.3+</td>
                    </tr>
                    <tr>
                        <th>Hardware</th>
                        <td>
                            NVidia cards, Apple Silicon (e.g. M1 processor), Chromebook Plus
                            <br />
                            or at least a 4 core CPU with 16GB+ RAM
                        </td>
                        <td>5.5GB+ of VRAM</td>
                    </tr>
                    <tr>
                        <th>Storage</th>
                        <td>22GB</td>
                        <td>20GB</td>
                    </tr>
                    <tr>
                        <th>Network</th>
                        <td colspan="2">
                            A reliable, cheap, and fast internet is required to download the initial model. After that,
                            you don't need internet for this extension.
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </main>
        <main id="prompt-api-ui" class="grow-flex" hidden>
            <div id="prompt-api-init" class="v-flex">
                <div class="welcome">
                    <img src="images/icon-128.png" alt="Logo" />
                    <div class="welcome__message">Local Browser AI</div>
                </div>
                <fieldset>
                    <legend>Options</legend>
                    <label for="option-temperature">
                        Temperature:
                        <output for="option-temperature" id="option-temperature-value">?</output>
                    </label>
                    <div class="subtle-text">How creative should the responses be?</div>
                    <input type="range" id="option-temperature" min="0" max="1" value="0.2" step="0.1" />
                    <label for="option-top-k">
                        TopK:
                        <output for="option-top-k" id="option-top-k-value">?</output>
                    </label>
                    <div class="subtle-text">How open-minded should the responses be?</div>
                    <input type="range" id="option-top-k" min="1" max="128" value="3" step="1" />
                </fieldset>
                <hr class="spacer spacer--4" />
                <fieldset>
                    <legend>Language</legend>
                    <label for="option-sys-lang">System</label>
                    <div class="subtle-text">Language of the system instruction in this page</div>
                    <select id="option-sys-lang"></select>
                    <label for="option-user-lang">User</label>
                    <div class="subtle-text">The language used by the user</div>
                    <select id="option-user-lang"></select>
                    <label for="option-assistant-lang">Response</label>
                    <div class="subtle-text">The language of the AI responses</div>
                    <select id="option-assistant-lang"></select>
                    <div class="box box--warn">
                        Prompt API seems to ignore user and assistant response language settings
                    </div>
                </fieldset>
                <label for="option-system-prompt">System Prompt</label>
                <div class="subtle-text">The instructions that guide the responses in your entire chat session</div>
                <textarea id="option-system-prompt" class="grow-flex" placeholder="System prompt"></textarea>
                <div class="button-bar">
                    <button id="init-button" class="cta">Initialize</button>
                </div>
            </div>

            <div id="download-status" hidden>
                <div id="init-loading-animation" class="loading-animation"></div>
                <progress id="download-progress" min="0" max="1" value="0"></progress>
                <span id="download-eta">ETA</span>
                <div class="button-bar">
                    <button id="init-stop-button">Stop</button>
                </div>
            </div>

            <div id="session-established" class="v-flex" hidden>
                <div id="chat-placeholder" class="welcome">
                    <img src="images/icon-128.png" alt="Logo" />
                    <div class="welcome__message">How can I help you?</div>
                    <div id="example-prompts"></div>
                </div>
                <div id="chat-history" class="chat-container grow-flex"></div>
                <div id="chat-loading-animation" class="loading-animation" hidden></div>
                <div id="add-context-reminder" class="box box--info">
                    You can now select a text or add an entire page to your chat as context by right clicking the page
                </div>
                <meter id="usage-ratio" title="Remaining Quota" value="0" low="0.1" high="0.9" optimum="0"></meter>
                <div class="prompt-section">
                    <textarea id="prompt-input" placeholder="Type your prompt here..."></textarea>
                    <div class="prompt-controls">
                        <span class="stat prompt-token-count subtle-text grow-flex" title="Prompt Tokens">
                            Prompt
                            <output id="prompt-tokens" for="prompt-input" class="value">...</output>
                            <span class="unit">tok</span>
                        </span>
                        <label for="option-streaming">
                            <input type="checkbox" id="option-streaming" checked />
                            Streaming
                        </label>
                        <button id="submit-prompt-button" class="cta">Submit</button>
                        <button id="stop-prompt-button" hidden>Stop</button>
                    </div>
                </div>
                <div id="prompt-stats" hidden>
                    <div title="Tokens" class="prompt-stats">
                        <span class="stat" title="Tokens generated per second during inference">
                            TPS <span id="token-per-second" class="value">?</span>
                        </span>
                        <span class="stat" title="Time to first token in millisecond">
                            TTFT <span id="time-to-first-token" class="value">?</span>
                        </span>
                        <span class="stat" title="The period where tokens were generated in millisecond">
                            Inf <span id="inference-duration" class="value">?</span>
                        </span>
                        <span class="stat" title="Total time it took till the end in millisecond">
                            Tot <span id="duration" class="value">?</span>
                        </span>
                    </div>
                </div>
            </div>
        </main>
        <footer class="subtle-text">
            <img src="images/swedish-flag.svg" alt="Swedish Flag" class="flag" /> Made in Sweden
        </footer>
        <script type="module" src="side-panel.js"></script>
    </body>
</html>
